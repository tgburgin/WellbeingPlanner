<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

</head>
<body class="{{ 'dark-mode' if dark_mode else '' }}">
    <div class="container">
        <h1>Settings</h1>
        <form class="{{ 'dark-mode' if dark_mode else '' }}" method="POST" action="{{ url_for('settings') }}">
            <div class="mb-3">
                <label for="fitness_test_choice" class="form-label">Default Fitness Test</label>
                <select id="fitness_test_choice" name="fitness_test_choice" class="form-select">
                    {% for test in fitness_tests %}
                    <option value="{{ test.id }}" {% if test.id == fitness_test_choice %}selected{% endif %}>
                        {{ test.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label for="calendar_color" class="form-label">Calendar Color</label>
                <div class="d-flex flex-wrap" id="colorPalette">
                    {% for color_id, color_info in calendar_colors.items() %}
                    <div class="color-swatch m-1 {% if color_id == calendar_color %}selected{% endif %}" 
                        data-value="{{ color_id }}" 
                        style="background-color: {{ color_info['background'] }};"
                        title="{{ color_info['name'] }}">
                    </div>
                    {% endfor %}
                </div>
                <input type="hidden" id="calendar_color" name="calendar_color" value="{{ calendar_color }}">
                <small>Choose a color for your Google Calendar.</small>
            </div>                                                                                                            
            <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
    </div>
    <script src="{{ url_for('static', filename='js/dark_mode.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const colorPalette = document.getElementById('colorPalette');
            const hiddenInput = document.getElementById('calendar_color');
    
            colorPalette.addEventListener('click', (event) => {
                const selectedSwatch = event.target.closest('.color-swatch');
                if (selectedSwatch) {
                    // Remove the 'selected' class from all swatches
                    document.querySelectorAll('.color-swatch').forEach(swatch => swatch.classList.remove('selected'));
                    
                    // Add the 'selected' class to the clicked swatch
                    selectedSwatch.classList.add('selected');
                    
                    // Update the hidden input value
                    hiddenInput.value = selectedSwatch.getAttribute('data-value');
                }
            });
        });
    </script>    
</body>
</html>
